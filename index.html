<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Nova Reforma IR 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #166534;
            cursor: pointer;
            border-radius: 50%;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen flex flex-col items-center py-8 px-4">

    <!-- Header -->
    <header class="text-center mb-8 max-w-2xl">
        <h1 class="text-3xl font-bold text-green-800 mb-2">Simulador Nova Reforma Tributária</h1>
        <p class="text-slate-600">Calcule seu salário líquido com base na Lei nº 15.270/2025 (Isenção até R$ 5.000,00).</p>
    </header>

    <!-- Main Card -->
    <main class="w-full max-w-md bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-200">
        
        <!-- Input Section -->
        <div class="p-6 bg-slate-100 border-b border-slate-200">
            <label class="block text-sm font-semibold text-slate-700 mb-2">Salário Bruto Mensal (R$)</label>
            <div class="relative">
                <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 font-medium">R$</span>
                <input type="number" id="salaryInput" placeholder="0,00" class="w-full pl-12 pr-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none text-xl font-bold text-slate-800 transition-all shadow-sm" oninput="calculateTax()">
            </div>
            <p class="text-xs text-slate-500 mt-2 flex items-center gap-1">
                <i class="fas fa-info-circle"></i> Digite apenas números.
            </p>
        </div>

        <!-- Results Section -->
        <div class="p-6 space-y-4">
            
            <!-- Summary Cards -->
            <div class="grid grid-cols-2 gap-3">
                <div class="bg-blue-50 p-3 rounded-lg border border-blue-100">
                    <p class="text-xs text-blue-600 font-semibold uppercase">INSS Estimado</p>
                    <p class="text-lg font-bold text-blue-800" id="inssVal">R$ 0,00</p>
                </div>
                <div class="bg-purple-50 p-3 rounded-lg border border-purple-100">
                    <p class="text-xs text-purple-600 font-semibold uppercase">Base de Cálculo</p>
                    <p class="text-lg font-bold text-purple-800" id="baseVal">R$ 0,00</p>
                </div>
            </div>

            <!-- IR Highlight -->
            <div class="bg-red-50 p-4 rounded-xl border border-red-100 relative overflow-hidden">
                <div class="relative z-10 flex justify-between items-center">
                    <div>
                        <p class="text-xs text-red-600 font-bold uppercase tracking-wider">Imposto de Renda (IRPF)</p>
                        <p class="text-2xl font-black text-red-700 mt-1" id="irpfVal">R$ 0,00</p>
                        <div class="flex items-center gap-2 mt-1">
                            <span class="text-xs bg-red-200 text-red-800 px-2 py-0.5 rounded-full font-medium" id="aliquotaEfetiva">0,0% Efetiva</span>
                            <span class="text-xs text-red-500" id="formulaTag" style="display:none;">(Fórmula Redutora)</span>
                        </div>
                    </div>
                    <div class="h-10 w-10 bg-red-200 rounded-full flex items-center justify-center text-red-600">
                        <i class="fas fa-file-invoice-dollar text-xl"></i>
                    </div>
                </div>
                <!-- Discount Visualization if needed -->
                <div id="reductionBox" class="mt-3 pt-3 border-t border-red-200 text-xs text-red-700 hidden">
                    <p>Redução aplicada pela nova lei:</p>
                    <p class="font-mono" id="reductionMath">D = 978,62 - (0,13... * Base)</p>
                    <p class="font-bold text-green-700" id="reductionAmount">- R$ 0,00 de desconto</p>
                </div>
            </div>

            <!-- Net Salary -->
            <div class="bg-green-600 text-white p-5 rounded-xl shadow-lg transform transition-transform hover:scale-[1.02]">
                <p class="text-sm text-green-100 font-medium mb-1">Salário Líquido a Receber</p>
                <div class="flex justify-between items-end">
                    <p class="text-3xl font-bold" id="netVal">R$ 0,00</p>
                    <i class="fas fa-wallet text-2xl text-green-400 opacity-70"></i>
                </div>
            </div>
        </div>

        <!-- Explanation Accordion -->
        <div class="bg-slate-50 p-4 border-t border-slate-200 text-sm">
            <h3 class="font-bold text-slate-700 mb-2"><i class="fas fa-calculator mr-1"></i> Entenda o Cálculo</h3>
            <ul class="space-y-2 text-slate-600" id="explanationList">
                <li id="step1" class="flex gap-2"><i class="fas fa-check text-green-500 mt-0.5"></i> <span>Digite seu salário para ver o detalhamento.</span></li>
            </ul>
        </div>
    </main>

    <footer class="mt-8 text-center max-w-lg text-xs text-slate-400">
        <p>Baseado na Lei nº 15.270/2025. O cálculo do INSS é uma estimativa progressiva baseada nas tabelas vigentes (Teto 2025 aprox.). A simulação considera contribuinte sem dependentes.</p>
    </footer>

    <script>
        // Formatter for Currency
        const formatBRL = (value) => {
            return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        };

        // INSS Calculation (Progressive 2025 Estimate)
        // Uses standard progressive logic. Ceiling estimated at 908.85 (2024) -> adjusted slightly for 2025 context if needed, keeping standard logic.
        function calculateINSS(salary) {
            let inss = 0;
            // Tabela INSS 2024 (usada como base estimativa)
            const faixas = [
                { limit: 1412.00, rate: 0.075 },
                { limit: 2666.68, rate: 0.09 },
                { limit: 4000.03, rate: 0.12 },
                { limit: 7786.02, rate: 0.14 } // Teto RGPS
            ];

            let remainingSalary = salary;
            let previousLimit = 0;

            for (const faixa of faixas) {
                if (salary > previousLimit) {
                    const rangeBase = Math.min(salary, faixa.limit) - previousLimit;
                    inss += rangeBase * faixa.rate;
                    previousLimit = faixa.limit;
                }
            }

            // Cap at the ceiling (calculated based on max limit)
            const teto = 7786.02; 
            const tetoINSS = 908.85; // Approx current ceiling value
            // Recalculating exact max to be precise
            let maxInss = 0;
            let prev = 0;
            for(let f of faixas) {
                maxInss += (f.limit - prev) * f.rate;
                prev = f.limit;
            }
            
            if (salary > teto) return maxInss;
            return inss;
        }

        // Standard IRPF Calculation (Old Rules / Base for Hybrid Calc)
        // Used to determine the pre-reduction tax amount in the transition zone
        function calculateStandardIRPF(base) {
            // Tabela Progressiva Padrão (Vigente/Congelada base)
            if (base <= 2259.20) return 0;
            if (base <= 2826.65) return (base * 0.075) - 169.44;
            if (base <= 3751.05) return (base * 0.150) - 381.44;
            if (base <= 4664.68) return (base * 0.225) - 662.77;
            return (base * 0.275) - 896.00;
        }

        function calculateTax() {
            const input = document.getElementById('salaryInput');
            const grossSalary = parseFloat(input.value);

            if (isNaN(grossSalary) || grossSalary < 0) {
                resetUI();
                return;
            }

            // 1. Calculate INSS
            const inss = calculateINSS(grossSalary);
            const baseCalc = grossSalary - inss;

            // 2. Calculate IRPF (New Law Logic)
            let irpf = 0;
            let explanation = [];
            let reductionAmount = 0;
            let isTransition = false;

            explanation.push(`1. Desconto do INSS: ${formatBRL(inss)}`);
            explanation.push(`2. Base de Cálculo (Bruto - INSS): ${formatBRL(baseCalc)}`);

            if (baseCalc <= 5000) {
                // Exempt Zone
                irpf = 0;
                explanation.push(`<span class="text-green-600 font-bold">3. Isento!</span> Sua base é inferior a R$ 5.000,00.`);
            } else if (baseCalc <= 7350) {
                // Transition Zone (Formula)
                isTransition = true;
                
                // Step A: Calculate Standard Tax
                const standardTax = calculateStandardIRPF(baseCalc);
                
                // Step B: Calculate Reduction D = 978,62 - (0,133145 x R)
                const D = 978.62 - (0.133145 * baseCalc);
                
                // Ensure D isn't negative (though math says it hits 0 at 7350)
                const discount = Math.max(0, D);
                
                // Final Tax
                irpf = Math.max(0, standardTax - discount);
                reductionAmount = discount;

                explanation.push(`3. Faixa de Transição (R$ 5k - R$ 7.35k).`);
                explanation.push(`4. Imposto Padrão seria: ${formatBRL(standardTax)}.`);
                explanation.push(`5. Redução da Nova Lei: <span class="text-green-600 font-bold">-${formatBRL(discount)}</span>.`);
            } else {
                // Standard Zone (> 7350)
                // Note: The document implies the standard curve continues. 
                // We use the standard 27.5% logic here.
                irpf = calculateStandardIRPF(baseCalc);
                explanation.push(`3. Faixa Superior (> R$ 7.350). Tributação pela tabela normal.`);
            }

            // 3. Final Net
            const netSalary = grossSalary - inss - irpf;
            const effectiveRate = (irpf / grossSalary) * 100;

            // Update UI
            document.getElementById('inssVal').innerText = formatBRL(inss);
            document.getElementById('baseVal').innerText = formatBRL(baseCalc);
            document.getElementById('irpfVal').innerText = formatBRL(irpf);
            document.getElementById('netVal').innerText = formatBRL(netSalary);
            document.getElementById('aliquotaEfetiva').innerText = `${effectiveRate.toFixed(2)}% Efetiva`;

            // Handle Reduction Visibility
            const reductionBox = document.getElementById('reductionBox');
            const formulaTag = document.getElementById('formulaTag');
            
            if (isTransition) {
                reductionBox.classList.remove('hidden');
                formulaTag.style.display = 'inline';
                document.getElementById('reductionMath').innerText = `D = 978,62 - (0,133145 * ${baseCalc.toFixed(2)})`;
                document.getElementById('reductionAmount').innerText = `Redução: -${formatBRL(reductionAmount)}`;
            } else {
                reductionBox.classList.add('hidden');
                formulaTag.style.display = 'none';
            }

            // Update List
            const list = document.getElementById('explanationList');
            list.innerHTML = explanation.map(item => `<li class="flex gap-2 items-start"><i class="fas fa-chevron-right text-slate-400 mt-1 text-xs"></i> <span>${item}</span></li>`).join('');
        }

        function resetUI() {
            document.getElementById('inssVal').innerText = "R$ 0,00";
            document.getElementById('baseVal').innerText = "R$ 0,00";
            document.getElementById('irpfVal').innerText = "R$ 0,00";
            document.getElementById('netVal').innerText = "R$ 0,00";
            document.getElementById('explanationList').innerHTML = '<li class="flex gap-2"><i class="fas fa-check text-green-500 mt-0.5"></i> <span>Digite seu salário para ver o detalhamento.</span></li>';
            document.getElementById('reductionBox').classList.add('hidden');
            document.getElementById('formulaTag').style.display = 'none';
        }
    </script>
</body>
</html>